{% extends "base.html" %}

{% block content %}
    <div class="row justify-content-center pt-3 g-3">
        <!-- Player List on the Left -->
        <div class="col-12 col-sm-10 col-lg-3">
            <div class="card">
               <div class="card-body">
                    <h3 class="card-title">Player List</h3>
                    <ul class="list-group" id="players">
                        {% for player in players %}
                            <li class="list-group-item">{{ player.username }}</li>
                        {% else %}
                            No players yet.
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>

        <!-- Settings Menu on the Right -->
        <div class="col-12 col-sm-10 col-lg-6">
            <div class="card">
                <div class="card-body">
                    <h3 class="card-title">Settings</h3>
                    <div>Nothing here yet</div>
                    <!-- Game settings form stuff-->
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block script %}
    <script
			  src="https://code.jquery.com/jquery-3.7.1.min.js"
			  integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
			  crossorigin="anonymous"></script>
    <script>
    $(document).ready(function() {
        function updatePlayerList() {
            /**
            * Periodically updates the list of players in the game lobby.
            * 
            * This function fetches the current list of players from a Flask API endpoint and updates
            * the HTML of the page to reflect any changes in the lobby. It uses AJAX to make a GET request
            * to the server and then dynamically updates the content of a list in the HTML without reloading the page.
            * The function is set to run every 5 seconds, providing near real-time updates of the player list.
            *
            * The `hashedGameId` is a variable interpolated from the server-side template, which represents
            * a securely hashed identifier for the game. This ID is used to make the API call to the correct endpoint.
            */
            const hashedGameId = '{{hashed_game_id}}';
            $.getJSON(`/api/v1/lobby/state/${hashedGameId}`, function(data) {
                const players = data.players;
                const $list = $('#players');
                $list.empty();
                players.forEach(function(player) {
                    $list.append(`<li class="list-group-item">${player.username}</li>`);
                });
                if (players.length < 1){
                    $list.append("No players yet.");
                }   
            }).fail(function() {
                console.error("Failed to fetch players.");
                $('#player-list').append('<p>Error loading players.</p>');
            });
        }
        setInterval(updatePlayerList, 5000);
    });
    </script>

{% endblock %}